## Mysql常见问题

#### 1.MyISAM和InnoDB下B+树索引的区别?

##### 相同点:

1.都是采用了B+数据的数据结构存储

##### 不同点:

1.InnoDB的索引存储文件和数据存储在一起,MyISAM则是索引和数据分开为两个文件存储

2.InnoDB的聚集索引(主键索引)上叶子节点上面存储的是数据,而非聚集索引(辅助索引)存的是主键id

MyISAM的主键索引和辅助索引没有任何区别,在叶子节点上面存储的都是数据的磁盘地址

#### 2.索引的类型有哪几种?

1.全文索引:主要针对于大文本,例如使用like查询效率的问题,只有**文本类型**的字段才可以建立全文索引.同时建立了全文索引后需要使用特殊语法,同时全文索引默认情况下只会对数据长度达到一定程度的数据建立索引,不同引擎下面的默认长度不一样,只有mysiam支持

> select * from fulltext_test     where match(content) against('xxx xxx');

2.普通索引:也称为非唯一限制,没有限制

3.唯一索引:和名称一样,唯一索引的要求键值不能重复,主键的索引其实也是一种特殊的唯一索引,只是主键索引要求多了一个限制条件,由于主键的特性,主键索引是不允许为空的.

4.前缀索引:当字段值比较长的时候，建立索引会消耗很多的空间，搜索起来也会很慢。我们可以通过截取字段的前面一部分内容建立索引，这个就叫前缀索引



#### 3.主键方式中hash索引的特点?使用场景?

1.它的时间复杂度是 O(1)，查询速度比较快。因为哈希索引里面的数据不是按顺序存储的，所以不能用于排序。
2.我们在查询数据的时候要根据键值计算哈希码，所以它只能支持等值查询（= IN），不支持范围查询（> < >= <= between and）。
3.就是如果字段重复值很多的时候，会出现大量的哈希冲突（采用拉链法解
决），效率会降低。

场景:

	InnoDB 内部使用哈希索引来实现自适应哈希索引特性。
​	这句话的意思是 **InnoDB 只支持显式创建 B+Tree 索引**，对于一些热点数据页，InnoDB 会自动建立自适应 Hash 索引，也就是在 B+Tree 索引基础上建立 Hash 索引，这个过程对于客户端是不可控制的，隐式的。
​	我们在 Navicat 工具里面选择索引方法是哈希，但是它创建的还是 B+Tree 索引，这个不是我们可以手动控制的。buffer pool 里面有一块区域是 Adaptive Hash Index 自适应哈希索引，就是这个。

![image-20201014213241097](https://hangxu-1258008370.cos.ap-guangzhou.myqcloud.com/md/image-20201014213241097.png)

#### 4.为什么InnoDB叶子节点存储的不是磁盘地址?

> 由于innodb引擎数据存储单位是页,在插入数据过程可能会产生页分裂导致磁盘地址变化,所以没有这样设计.

#### 5.什么是回表?

​	前面提到MyISAM和InnoDB的b+树的区别,当innodb在查完二级索引后,这些被二级索命中的数据,由于这些数据只是存储了索引列数据和主键的id,当需要查询结果超出索引列的时候,则需要进行回表查询(就是拿着这些数据对应的主键id到一级索引中去查询数据).

#### 6.什么是覆盖索引

​	当所需要查询的列只用从索引中就能获得,不必从数据区读取,这时使用的索引就叫做覆盖索引.(是不是不需要回表的操作都算?)

#### 7.什么是索引下推?

* 索引下推是mysql在5.6版本推出的,用于查询优化,简称**ICP**
* 在不使用**ICP**的情况下,在使用非主键索引进行查询时候,

注意:**索引的比较是在存储引擎进行的，数据记录的比较，是在 Server 层进行的**
而当 first_name 的条件不能用于索引过滤时，Server 层不会把 first_name 的条件传递给存储引擎，所以读取了两条没有必要的记录。
这时候，如果满足 last_name='wang'的记录有 100000 条，就会有 99999 条没有
必要读取的记录。

> Using Where 代表从存储引擎取回的数据不全部满足条件，需要在 Server 层过滤。

#### 8.数据库logbuffer的写入时机

![image-20201208162553047](https://hangxu-1258008370.cos.ap-guangzhou.myqcloud.com/md/image-20201208162553047.png)