## 缓存一致性和cpu

### 1.cacheLine(缓存行)

​		**Cache Line可以简单的理解为CPU Cache中的最小缓存单位**。目前主流的CPU Cache的Cache Line大小都是64Bytes。假设我们有一个512字节的一级缓存，那么按照64B的缓存单位大小来算，这个一级缓存所能存放的缓存个数就是512/64 = 8个。



### 2.volatile的使用优化

​	在使用LinkTransferQueue中,它在使用volatile变量时候,使用了一种追加字节的方式来优化了队列的出队和入队的性能.

	>主要为了防止头结点和尾结点被加载到一个同一个缓存行中导致,修改头尾节点时候会相互锁定.

### 3.缓存一致性解决的办法

![image-20201018175928336](https://hangxu-1258008370.cos.ap-guangzhou.myqcloud.com/md/image-20201018175928336.png)

1.总线锁

​	总线上发出一个 LOCK#信号，这个信号使得其他处理器无法通过总线来访问到共享内存中的数据，**不能操作缓存了该共享变量内存地址的缓存**, 总线锁定把 CPU 和内存之间的通信锁住了，这使得锁定期间，其他处理器不能操作其他内存地址的数据，所以总线锁定的开销比较大， 这种机制显然是不合适的.类似于分布式中的思想.

2.缓存锁

​	实现缓存锁,则是基于缓存一致性协议来实现的.其中最常见的就是mesi协议.每条缓存都有一个状态位.



